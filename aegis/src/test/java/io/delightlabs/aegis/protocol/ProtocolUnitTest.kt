package io.delightlabs.aegis.protocol

import io.delightlabs.aegis.crypt.NoCryptShare
import io.delightlabs.aegis.protocol.*
import org.junit.Assert
import org.junit.Test

class ProtocolUnitTest {

    @OptIn(ExperimentalUnsignedTypes::class)
    @Test
    fun `pack & unpack`() {

        val ncs = NoCryptShare(ByteArray(0))
        ncs.content = "TEST_V1_PACKET_1234567890".toByteArray()
        val result = pack(Version.V1, ncs)
        Assert.assertEquals(ubyteArrayOf(
            123.toUByte(),
            34.toUByte(),
            112.toUByte(),
            114.toUByte(),
            111.toUByte(),
            116.toUByte(),
            111.toUByte(),
            99.toUByte(),
            111.toUByte(),
            108.toUByte(),
            95.toUByte(),
            118.toUByte(),
            101.toUByte(),
            114.toUByte(),
            115.toUByte(),
            105.toUByte(),
            111.toUByte(),
            110.toUByte(),
            34.toUByte(),
            58.toUByte(),
            34.toUByte(),
            86.toUByte(),
            49.toUByte(),
            34.toUByte(),
            44.toUByte(),
            34.toUByte(),
            112.toUByte(),
            97.toUByte(),
            99.toUByte(),
            107.toUByte(),
            101.toUByte(),
            116.toUByte(),
            34.toUByte(),
            58.toUByte(),
            34.toUByte(),
            101.toUByte(),
            121.toUByte(),
            74.toUByte(),
            106.toUByte(),
            99.toUByte(),
            110.toUByte(),
            108.toUByte(),
            119.toUByte(),
            100.toUByte(),
            70.toUByte(),
            57.toUByte(),
            104.toUByte(),
            98.toUByte(),
            71.toUByte(),
            100.toUByte(),
            118.toUByte(),
            99.toUByte(),
            109.toUByte(),
            108.toUByte(),
            48.toUByte(),
            97.toUByte(),
            71.toUByte(),
            48.toUByte(),
            105.toUByte(),
            79.toUByte(),
            105.toUByte(),
            74.toUByte(),
            79.toUByte(),
            84.toUByte(),
            49.toUByte(),
            57.toUByte(),
            68.toUByte(),
            85.toUByte(),
            108.toUByte(),
            108.toUByte(),
            81.toUByte(),
            86.toUByte(),
            67.toUByte(),
            73.toUByte(),
            115.toUByte(),
            73.toUByte(),
            110.toUByte(),
            78.toUByte(),
            111.toUByte(),
            89.toUByte(),
            88.toUByte(),
            74.toUByte(),
            108.toUByte(),
            88.toUByte(),
            51.toUByte(),
            66.toUByte(),
            104.toUByte(),
            89.toUByte(),
            50.toUByte(),
            116.toUByte(),
            108.toUByte(),
            100.toUByte(),
            67.toUByte(),
            73.toUByte(),
            54.toUByte(),
            73.toUByte(),
            109.toUByte(),
            86.toUByte(),
            53.toUByte(),
            83.toUByte(),
            106.toUByte(),
            66.toUByte(),
            105.toUByte(),
            77.toUByte(),
            49.toUByte(),
            74.toUByte(),
            111.toUByte(),
            89.toUByte(),
            107.toUByte(),
            78.toUByte(),
            74.toUByte(),
            78.toUByte(),
            107.toUByte(),
            49.toUByte(),
            68.toUByte(),
            100.toUByte(),
            50.toUByte(),
            108.toUByte(),
            107.toUByte(),
            82.toUByte(),
            50.toUByte(),
            104.toUByte(),
            53.toUByte(),
            87.toUByte(),
            108.toUByte(),
            104.toUByte(),
            79.toUByte(),
            98.toUByte(),
            50.toUByte(),
            73.toUByte(),
            121.toUByte(),
            101.toUByte(),
            71.toUByte(),
            116.toUByte(),
            74.toUByte(),
            97.toUByte(),
            109.toUByte(),
            57.toUByte(),
            51.toUByte(),
            84.toUByte(),
            69.toUByte(),
            78.toUByte(),
            75.toUByte(),
            97.toUByte(),
            109.toUByte(),
            73.toUByte(),
            121.toUByte(),
            78.toUByte(),
            84.toUByte(),
            66.toUByte(),
            97.toUByte(),
            86.toUByte(),
            122.toUByte(),
            85.toUByte(),
            119.toUByte(),
            83.toUByte(),
            87.toUByte(),
            112.toUByte(),
            118.toUByte(),
            97.toUByte(),
            86.toUByte(),
            90.toUByte(),
            114.toUByte(),
            86.toUByte(),
            108.toUByte(),
            100.toUByte(),
            87.toUByte(),
            82.toUByte(),
            108.toUByte(),
            112.toUByte(),
            72.toUByte(),
            84.toUByte(),
            49.toUByte(),
            90.toUByte(),
            107.toUByte(),
            84.toUByte(),
            108.toUByte(),
            90.toUByte(),
            113.toUByte(),
            98.toUByte(),
            70.toUByte(),
            74.toUByte(),
            86.toUByte(),
            86.toUByte(),
            108.toUByte(),
            90.toUByte(),
            80.toUByte(),
            86.toUByte(),
            69.toUByte(),
            90.toUByte(),
            75.toUByte(),
            86.toUByte(),
            49.toUByte(),
            86.toUByte(),
            116.toUByte(),
            87.toUByte(),
            107.toUByte(),
            53.toUByte(),
            87.toUByte(),
            82.toUByte(),
            87.toUByte(),
            119.toUByte(),
            50.toUByte(),
            86.toUByte(),
            71.toUByte(),
            116.toUByte(),
            83.toUByte(),
            86.toUByte(),
            107.toUByte(),
            49.toUByte(),
            114.toUByte(),
            78.toUByte(),
            84.toUByte(),
            90.toUByte(),
            97.toUByte(),
            101.toUByte(),
            108.toUByte(),
            90.toUByte(),
            79.toUByte(),
            85.toUByte(),
            86.toUByte(),
            81.toUByte(),
            119.toUByte(),
            79.toUByte(),
            85.toUByte(),
            108.toUByte(),
            117.toUByte(),
            77.toUByte(),
            68.toUByte(),
            48.toUByte(),
            105.toUByte(),
            102.toUByte(),
            81.toUByte(),
            61.toUByte(),
            61.toUByte(),
            34.toUByte(),
            125.toUByte()
        ).contentToString(), result.contentToString())

        val unpacked = unpack(result)
        Assert.assertEquals(ncs, unpacked)
    }

}