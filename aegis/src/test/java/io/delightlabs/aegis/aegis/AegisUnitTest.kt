package io.delightlabs.aegis

import io.delightlabs.aegis.common.Secret
import io.delightlabs.aegis.crypt.Algorithm
import io.delightlabs.aegis.crypt.NoCryptShare
import io.delightlabs.aegis.crypt.cipher.Version as CipherVersion
import io.delightlabs.aegis.protocol.Protocol
import io.delightlabs.aegis.protocol.Version as ProtocolVersion
import io.delightlabs.aegis.protocol.pack
import io.delightlabs.aegis.protocol.unpack
import org.junit.Assert
import org.junit.Test

class AegisUnitTest {

    @OptIn(ExperimentalUnsignedTypes::class)
    @Test
    fun `aegis dealshare & cobineshare`() {
        val secret = "MESSAGE_1".toByteArray()
        val key = "01234567890123456789012345678901".toByteArray()

        val aegis = Aegis.dealShares(ProtocolVersion.V1, CipherVersion.V1, Algorithm.NO_CRYPT, 3, 3, secret, key)

        Assert.assertEquals(ubyteArrayOf(
            123.toUByte(),
            34.toUByte(),
            112.toUByte(),
            114.toUByte(),
            111.toUByte(),
            116.toUByte(),
            111.toUByte(),
            99.toUByte(),
            111.toUByte(),
            108.toUByte(),
            95.toUByte(),
            118.toUByte(),
            101.toUByte(),
            114.toUByte(),
            115.toUByte(),
            105.toUByte(),
            111.toUByte(),
            110.toUByte(),
            34.toUByte(),
            58.toUByte(),
            34.toUByte(),
            86.toUByte(),
            49.toUByte(),
            34.toUByte(),
            44.toUByte(),
            34.toUByte(),
            112.toUByte(),
            97.toUByte(),
            99.toUByte(),
            107.toUByte(),
            101.toUByte(),
            116.toUByte(),
            34.toUByte(),
            58.toUByte(),
            34.toUByte(),
            101.toUByte(),
            121.toUByte(),
            74.toUByte(),
            106.toUByte(),
            99.toUByte(),
            110.toUByte(),
            108.toUByte(),
            119.toUByte(),
            100.toUByte(),
            70.toUByte(),
            57.toUByte(),
            104.toUByte(),
            98.toUByte(),
            71.toUByte(),
            100.toUByte(),
            118.toUByte(),
            99.toUByte(),
            109.toUByte(),
            108.toUByte(),
            48.toUByte(),
            97.toUByte(),
            71.toUByte(),
            48.toUByte(),
            105.toUByte(),
            79.toUByte(),
            105.toUByte(),
            74.toUByte(),
            79.toUByte(),
            84.toUByte(),
            49.toUByte(),
            57.toUByte(),
            68.toUByte(),
            85.toUByte(),
            108.toUByte(),
            108.toUByte(),
            81.toUByte(),
            86.toUByte(),
            67.toUByte(),
            73.toUByte(),
            115.toUByte(),
            73.toUByte(),
            110.toUByte(),
            78.toUByte(),
            111.toUByte(),
            89.toUByte(),
            88.toUByte(),
            74.toUByte(),
            108.toUByte(),
            88.toUByte(),
            51.toUByte(),
            66.toUByte(),
            104.toUByte(),
            89.toUByte(),
            50.toUByte(),
            116.toUByte(),
            108.toUByte(),
            100.toUByte(),
            67.toUByte(),
            73.toUByte(),
            54.toUByte(),
            73.toUByte(),
            109.toUByte(),
            86.toUByte(),
            53.toUByte(),
            83.toUByte(),
            106.toUByte(),
            66.toUByte(),
            105.toUByte(),
            77.toUByte(),
            49.toUByte(),
            74.toUByte(),
            111.toUByte(),
            89.toUByte(),
            107.toUByte(),
            78.toUByte(),
            74.toUByte(),
            78.toUByte(),
            107.toUByte(),
            49.toUByte(),
            68.toUByte(),
            100.toUByte(),
            50.toUByte(),
            108.toUByte(),
            107.toUByte(),
            82.toUByte(),
            50.toUByte(),
            104.toUByte(),
            53.toUByte(),
            87.toUByte(),
            108.toUByte(),
            104.toUByte(),
            79.toUByte(),
            98.toUByte(),
            50.toUByte(),
            73.toUByte(),
            121.toUByte(),
            101.toUByte(),
            71.toUByte(),
            116.toUByte(),
            74.toUByte(),
            97.toUByte(),
            109.toUByte(),
            57.toUByte(),
            51.toUByte(),
            84.toUByte(),
            69.toUByte(),
            78.toUByte(),
            75.toUByte(),
            97.toUByte(),
            109.toUByte(),
            73.toUByte(),
            121.toUByte(),
            78.toUByte(),
            84.toUByte(),
            66.toUByte(),
            97.toUByte(),
            86.toUByte(),
            122.toUByte(),
            85.toUByte(),
            119.toUByte(),
            83.toUByte(),
            87.toUByte(),
            112.toUByte(),
            118.toUByte(),
            97.toUByte(),
            86.toUByte(),
            90.toUByte(),
            116.toUByte(),
            99.toUByte(),
            69.toUByte(),
            90.toUByte(),
            82.toUByte(),
            86.toUByte(),
            85.toUByte(),
            90.toUByte(),
            67.toUByte(),
            85.toUByte(),
            86.toUByte(),
            86.toUByte(),
            71.toUByte(),
            81.toUByte(),
            108.toUByte(),
            70.toUByte(),
            86.toUByte(),
            82.toUByte(),
            107.toUByte(),
            74.toUByte(),
            82.toUByte(),
            86.toUByte(),
            85.toUByte(),
            90.toUByte(),
            67.toUByte(),
            85.toUByte(),
            86.toUByte(),
            86.toUByte(),
            71.toUByte(),
            81.toUByte(),
            108.toUByte(),
            70.toUByte(),
            86.toUByte(),
            82.toUByte(),
            107.toUByte(),
            74.toUByte(),
            83.toUByte(),
            97.toUByte(),
            50.toUByte(),
            119.toUByte(),
            48.toUByte(),
            86.toUByte(),
            109.toUByte(),
            120.toUByte(),
            83.toUByte(),
            99.toUByte(),
            49.toUByte(),
            100.toUByte(),
            88.toUByte(),
            85.toUByte(),
            108.toUByte(),
            104.toUByte(),
            88.toUByte(),
            98.toUByte(),
            107.toUByte(),
            53.toUByte(),
            80.toUByte(),
            84.toUByte(),
            84.toUByte(),
            74.toUByte(),
            52.toUByte(),
            86.toUByte(),
            108.toUByte(),
            100.toUByte(),
            116.toUByte(),
            100.toUByte(),
            70.toUByte(),
            78.toUByte(),
            86.toUByte(),
            77.toUByte(),
            68.toUByte(),
            85.toUByte(),
            50.toUByte(),
            85.toUByte(),
            87.toUByte(),
            49.toUByte(),
            115.toUByte(),
            84.toUByte(),
            50.toUByte(),
            86.toUByte(),
            115.toUByte(),
            99.toUByte(),
            70.toUByte(),
            100.toUByte(),
            90.toUByte(),
            86.toUByte(),
            108.toUByte(),
            74.toUByte(),
            104.toUByte(),
            85.toUByte(),
            106.toUByte(),
            70.toUByte(),
            115.toUByte(),
            86.toUByte(),
            86.toUByte(),
            78.toUByte(),
            115.toUByte(),
            82.toUByte(),
            109.toUByte(),
            70.toUByte(),
            104.toUByte(),
            77.toUByte(),
            70.toUByte(),
            86.toUByte(),
            52.toUByte(),
            86.toUByte(),
            88.toUByte(),
            112.toUByte(),
            71.toUByte(),
            100.toUByte(),
            49.toUByte(),
            74.toUByte(),
            71.toUByte(),
            85.toUByte(),
            106.toUByte(),
            90.toUByte(),
            97.toUByte(),
            82.toUByte(),
            87.toUByte(),
            82.toUByte(),
            113.toUByte(),
            84.toUByte(),
            87.toUByte(),
            49.toUByte(),
            52.toUByte(),
            87.toUByte(),
            86.toUByte(),
            85.toUByte(),
            121.toUByte(),
            78.toUByte(),
            87.toUByte(),
            112.toUByte(),
            78.toUByte(),
            86.toUByte(),
            88.toUByte(),
            100.toUByte(),
            53.toUByte(),
            87.toUByte(),
            88.toUByte(),
            112.toUByte(),
            114.toUByte(),
            97.toUByte(),
            87.toUByte(),
            90.toUByte(),
            82.toUByte(),
            80.toUByte(),
            84.toUByte(),
            48.toUByte(),
            105.toUByte(),
            102.toUByte(),
            81.toUByte(),
            61.toUByte(),
            61.toUByte(),
            34.toUByte(),
            125.toUByte()
        ).contentToString(), aegis.payloads[0].toUByteArray().contentToString())
       val combined = aegis.combineShares(key)
        Assert.assertEquals(secret.contentToString(), combined.contentToString())
    }

}